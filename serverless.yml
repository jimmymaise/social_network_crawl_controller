service: on-demand-collection-services
provider:
  name: aws
  stage: dev
  runtime: ${self:custom.config.runtime}
  region: ${self:custom.config.region}
  memorySize: ${self:custom.config.memorySize}
  environment:
    LAMBDA: "LAMBDA"
  deploymentBucket:
    name: ${self:custom.config.deploymentBucket} # Deployment bucket name. Default is generated by the framework
    maxPreviousDeploymentArtifacts: 10 # On every deployment the framework prunes the bucket to remove artifacts older than this limit. The default is 5

package:
  include:
    - ./core/**
    - ./config/**
    - ./main.py
    - ./social_networks/**
    - '!**/.pytest_cache/**'
    - '!**/__pycache__/**'
  exclude:
    - ./**

plugins:
  - serverless-pseudo-parameters
  - serverless-python-requirements

custom:
  pythonRequirements:
    usePipenv: false
    useDownloadCache: false
    fileName: requirements.txt
    useStaticCache: true
    dockerizePip: non-linux
    zip: true
    noDeploy:
      - pytest
  config: ${file(./config/lambda_deploy_config/config.json)} # You can reference the entire file


functions:
  - main_func:
      role: ${self:custom.config.role}
      handler: main.lambda_handler
      description: "On-Demand collection services -  Data system"
      memorySize: ${self:custom.config.memorySize}
      timeout: 120
      events:
        # Provide the ARN of your queue. It will trigger this lambda
        - sqs:
            arn: ${self:custom.config.arn_sqs_user_collection}
            batchSize: 1